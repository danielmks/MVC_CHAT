# 다중 클라이언트 채팅 애플리케이션 (MVC, Observer, Mediator 패턴)

이 프로젝트는 Linux CLI 환경에서 동작하는 다중 클라이언트 채팅 서버와 클라이언트 프로그램을 C++로 구현한 예제입니다. MVC 아키텍처를 기반으로 하며, Observer 및 Mediator 디자인 패턴을 적용하여 메시지 전달 및 클라이언트 관리를 수행합니다.

## 주요 기능

- **MVC 아키텍처 적용**  
  - **모델 (Model)**: `ChatRoom` 클래스가 채팅방의 상태(연결된 클라이언트 목록)를 관리하고, Mediator 역할을 수행합니다.
  - **컨트롤러 (Controller)**: `ClientHandler` 클래스가 각 클라이언트와의 통신을 처리하고, 메시지 전송 및 포맷팅을 담당합니다.
  - **뷰 (View)**: 클라이언트 프로그램은 서버로부터 전달받은 포맷된 메시지를 터미널에 출력하며, 입력 프롬프트를 제공합니다.

- **디자인 패턴**  
  - **Observer 패턴**: 클라이언트가 Observer 인터페이스를 구현하여 메시지 업데이트를 수신합니다.
  - **Mediator 패턴**: `ChatRoom` 클래스가 중앙에서 메시지를 중재하여 모든 클라이언트에게 전달합니다.

- **다중 클라이언트 지원**  
  - 하나의 공용 채팅방에 여러 클라이언트가 동시에 접속할 수 있습니다.

- **메시지 포맷**  
  - 모든 메시지는 다음과 같은 형식으로 출력됩니다.
    ```
    닉네임 : 메시지 내용 (YYYY-MM-DD) (HH:MM)
    ```
  - 시간은 서울 기준으로 표시됩니다.

- **접속 및 종료 알림**  
  - 새로운 클라이언트가 접속하면 `Hello <닉네임>!` 메시지가 브로드캐스트됩니다.
  - 클라이언트가 나가면 `Bye <닉네임>!` 메시지가 브로드캐스트됩니다.

- **채팅 종료 기능**  
  - 클라이언트는 `!exit`를 입력하여 채팅을 종료할 수 있습니다.

- **입력 프롬프트 개선**  
  - 클라이언트 터미널에서는 `<닉네임> : ` 형태의 입력 프롬프트가 출력되며, 메시지는 위쪽에 포맷된 채팅 메시지로 출력됩니다.
  - ANSI escape sequence를 사용하여 메시지 수신 시 입력 프롬프트가 적절하게 갱신됩니다.

## 프로젝트 구조

```
.
├── Makefile
├── Patterns.h         # Observer와 Mediator 정의를 통합한 파일
├── ChatRoom.h         # [모델] 채팅방(메디에이터) 구현
├── ChatRoom.cpp
├── ClientHandler.h    # [컨트롤러] 클라이언트 핸들러 (Observer 구현)
├── ClientHandler.cpp
├── main.cpp           # [컨트롤러] 서버 진입점
└── client.cpp         # [뷰/컨트롤러] 클라이언트 프로그램
```

## 전제 조건

- Linux 환경
- C++11 이상
- `g++` 컴파일러
- `make` 유틸리티

## 컴파일 방법

프로젝트 루트 디렉토리에서 다음 명령을 실행하여 서버와 클라이언트 실행 파일을 생성합니다.

```bash
make
```

## 서버 실행

포트 번호를 인자로 서버를 실행합니다. 예를 들어, 포트 `12345`에서 실행하려면:

```bash
./server 12345
```

## 클라이언트 실행

서버 IP, 포트 번호, 그리고 닉네임을 인자로 클라이언트를 실행합니다. 예를 들어, 서버 IP가 `127.0.0.1`이고 포트가 `12345`이며, 닉네임이 `user1`인 경우:

```bash
./client 127.0.0.1 12345 user1
```

## 작동 원리

- **서버**:  
  - TCP 소켓을 생성하여 클라이언트 연결을 기다립니다.
  - 각 클라이언트마다 `ClientHandler` 객체를 생성하고 별도의 스레드로 통신을 처리합니다.
  - `ChatRoom` 클래스는 연결된 모든 클라이언트를 관리하며, 포맷된 메시지와 접속/종료 알림을 브로드캐스트합니다.

- **클라이언트**:  
  - 서버에 접속 후 닉네임을 전송하여 초기 설정을 완료합니다.
  - 별도의 스레드를 통해 서버로부터 포맷된 메시지를 수신하고 터미널에 출력합니다.
  - 사용자는 `<닉네임> : ` 프롬프트에서 메시지를 입력하며, 입력한 메시지는 서버로 전송됩니다.
  - ANSI escape sequence를 활용하여 메시지 수신 시 입력 프롬프트가 적절하게 갱신됩니다.

## 종료 방법

- 클라이언트는 `!exit`를 입력하여 채팅을 종료할 수 있습니다.
- 클라이언트 종료 시, 서버는 `Bye <닉네임>!` 메시지를 브로드캐스트합니다.

## 라이선스

이 프로젝트는 오픈 소스로 제공되며, 자유롭게 수정 및 배포할 수 있습니다.
```

---

필요에 따라 내용을 수정하거나 추가하시면 됩니다.
